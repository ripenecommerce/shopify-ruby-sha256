# Shopify Scripts Editor SHA256

SHA256 algorithm which functions within the limitations of the Shopify Script Editor app, useful for HMAC validation of
submitted data.

## Usage

Create a SECRET_KEY that is shared between the store frontend and the Shopify Script using random characters.

Within a Shopify liquid template, use the `sha256` string filter
(https://shopify.dev/docs/themes/liquid/reference/filters/string-filters#sha256)
to generate the SHA256 hash for the sensitive data, being sure to include the SECRET_KEY as part of the string. The
SECRET_KEY can be defined in the liquid template using `{% assign %}`
to prevent it from being exposed.

`{% assign SECRET_KEY='mysupersecretkey12345' %}`

The hash can then be generated within the liquid template:

```
    {% capture combined_data %}{{ currentProductVariantId }}{{ SECRET_KEY }}{{ product.price }}{% endcapture %}
    {% assign prod_hmac = combined_data | strip | sha256 | prepend: "," %}
```

Pass the resulting generated hash as a product line item property (such as '`_product_integrity`')
within the Add to Cart form so that it can be read by this Shopify Script when the cart is initialized, and validate it 
using the same formula used to generate the hash on the frontend, passed to the `sha256()` function within this script.

For example, if your hash passed from the frontend is generated by the product variant ID, the SECRET_KEY, and the product 
price, the Shopify Script should check the hash using something similar to:

```
 Input.cart.line_items.each do |line_item|
   SHA_HASH = sha256(line_item.variant.id.to_s + SECRET_KEY + line_item.final_price.to_s)
   if SHA_HASH == line_item.properties['_product_integrity']
     # Integrity verified, do something
   end
 end

 Output.cart = Input.cart
```

The above code would be appended to the contents of sha256.rb within the Shopify Script.

## Considerations

The Shopify Script will only have access to certain properties and objects, such as line item objects, 
so only these properties can be used to generate the SHA256 hash.
